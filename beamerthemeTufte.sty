% Beamer Theme: Tufte
% A minimalist presentation theme inspired by Edward Tufte's design principles
% and the tufte-css project
%
% Author: Created for tufte_beamer project
% License: MIT
%
% Features:
% - Tufte-CSS color palette (light or dark theme)
% - ET Book/Palatino (serif) or Fira Sans (sans-serif) typography
% - Minimal headline with navigation squares (current section only)
% - Progress bar with page numbers in footline
% - Clean title and section pages
% - Generous whitespace and margins
%
% Usage:
%   \usetheme{Tufte}                  % Default: dark theme, serif font
%   \usetheme[dark]{Tufte}            % Explicitly use dark theme
%   \usetheme[light]{Tufte}           % Use light theme
%   \usetheme[sans]{Tufte}            % Use Fira Sans font
%   \usetheme[nosub]{Tufte}           % Hide subsections in ToC
%   \usetheme[light,sans,nosub]{Tufte}  % Multiple options combined

\mode<presentation>

% Theme options
\DeclareOptionBeamer{light}{\PassOptionsToPackage{light}{beamercolorthemeTufte}}
\DeclareOptionBeamer{dark}{\PassOptionsToPackage{dark}{beamercolorthemeTufte}}
\DeclareOptionBeamer{sans}{\PassOptionsToPackage{sans}{beamerfontthemeTufte}}
\DeclareOptionBeamer{serif}{\PassOptionsToPackage{serif}{beamerfontthemeTufte}}
\DeclareOptionBeamer{nosub}{\PassOptionsToPackage{nosub}{beamerinnerthemeTufte}}
\ExecuteOptionsBeamer{dark}  % Default to dark and serif
\ProcessOptionsBeamer

% Required packages
\RequirePackage{tikz}
\RequirePackage{calc}
\RequirePackage{etoolbox}
\RequirePackage{tcolorbox}

% TikZ libraries for progress bar
\usetikzlibrary{calc}

% Load theme components
\usecolortheme{Tufte}
\usefonttheme{Tufte}
\useinnertheme{Tufte}
\useoutertheme{Tufte}

% General settings
\setbeamersize{text margin left=1cm,text margin right=1cm}

% Disable default Beamer navigation
\beamertemplatenavigationsymbolsempty

% Smooth transitions (optional)
\setbeamercovered{transparent=0}

% Hyperlink colors (subtle, matching Tufte-CSS)
\hypersetup{
  colorlinks=true,
  linkcolor=tufteaccent,
  urlcolor=tufteaccent,
  citecolor=tuftetext
}

% Additional spacing adjustments for Tufte aesthetic
\setlength{\parskip}{0.5em}
\setlength{\parindent}{0pt}

% Make footnotes smaller and less intrusive
\setbeamerfont{footnote}{size=\tiny}

% Adjust frame title spacing (since title is in headline)
\addtobeamertemplate{frametitle}{}{\vspace{-1em}}

%--------------------------------------------------
% PGFPlots Tufte Style (optional, requires pgfplots package)
%--------------------------------------------------

\AtBeginDocument{%
  \@ifpackageloaded{pgfplots}{%
    % Define Tufte-style axes for pgfplots
    \makeatletter
    \pgfplotsset{
      % Main Tufte style - can be activated with "tufte style"
      tufte style/.style = {
        % Remove axis box, draw only bottom and left axes
        after end axis/.code = {
          \draw ({rel axis cs:0,0} -| {axis cs:\pgfplots@data@xmin,0})
            -- ({rel axis cs:0,0} -| {axis cs:\pgfplots@data@xmax,0});
          \draw ({rel axis cs:0,0} |- {axis cs:0,\pgfplots@data@ymin})
            -- ({rel axis cs:0,0} |- {axis cs:0,\pgfplots@data@ymax});
        },
        axis line style = {draw = none},
        tick align = outside,
        tick pos = left,
        % Use theme colors
        every axis plot/.append style = {thick},
        axis line style = {color=tuftetext},
        tick label style = {color=tuftetext},
        label style = {color=tuftetext},
        % Minimal grid
        grid = none,
        % Legend style
        legend style = {
          draw = none,
          fill = none,
          cells = {anchor = west}
        }
      },
      % Tufte grid style - minimal grid lines
      tufte grid/.style = {
        grid = major,
        grid style = {color=tuftegray!30, thin}
      },
      % Default cycle list using theme colors
      tufte colors/.style = {
        cycle list = {
          {color=tuftetext, thick},
          {color=tufteaccent, thick},
          {color=tuftedarkgray, thick, dashed},
          {color=tuftegray, thick, dotted}
        }
      }
    }
    \makeatother
  }{}%
}

%--------------------------------------------------
% Custom tcolorbox: tufteframe
%--------------------------------------------------
% Extremely minimal box with just background color and title on top
%
% Usage:
%   \begin{tufteframe}{Title}
%     Content goes here
%   \end{tufteframe}

\newtcolorbox{tufteframe}[1]{
  colback=tuftecodebg,
  coltext=tuftetext,
  boxrule=0pt,
  arc=0pt,
  sharp corners,
  title={#1},
  fonttitle=\bfseries,
  coltitle=tuftetext,
  colbacktitle=tuftecodebg,
  top=3mm,
  bottom=3mm,
  left=3mm,
  right=3mm
}

%--------------------------------------------------
% Listings Configuration
%--------------------------------------------------
% Configure listings package if loaded

\AtBeginDocument{%
  \@ifpackageloaded{listings}{%
    \lstset{
      basicstyle=\ttfamily\scriptsize,
      keywordstyle=\color{tufteaccent},
      commentstyle=\color{tuftedarkgray}\itshape,
      stringstyle=\color{tuftedarkgray},
      numbers=left,
      numberstyle=\tiny\color{tuftegray},
      frame=none,
      backgroundcolor=\color{tuftecodebg},
      breaklines=true,
      showstringspaces=false
    }
  }{}%
}

%--------------------------------------------------
% Algorithm Configuration
%--------------------------------------------------
% Configure algorithm package if loaded

\AtBeginDocument{%
  \@ifpackageloaded{algpseudocode}{%
    % Use monospace font at scriptsize for algorithm text
    \makeatletter
    \algrenewcommand\ALG@beginalgorithmic{\ttfamily\scriptsize\color{tuftetext}}
    \makeatother
  }{}%
  %
  \@ifpackageloaded{algorithm}{%
    % Wrap algorithms in a styled box matching code blocks
    \tcbuselibrary{skins}
    \BeforeBeginEnvironment{algorithm}{%
      \begin{tcolorbox}[
        enhanced,
        colback=tuftecodebg,
        coltext=tuftetext,
        colframe=tuftecodebg,
        boxrule=0pt,
        sharp corners,
        top=2mm,
        bottom=2mm,
        left=2mm,
        right=2mm
      ]
    }
    \AfterEndEnvironment{algorithm}{%
      \end{tcolorbox}
    }
    % Fix algorithm caption/label colors
    \makeatletter
    \renewcommand{\fnum@algorithm}{\textcolor{tuftetext}{\ALG@name~\thealgorithm}}
    \makeatother
  }{}%
}

\mode<all>
